# domotech
	ИНСТРУКЦИЯ:
		1) залить в базу mysql sql дамп domotech.sql
		2) в файле conf.php прописать константы подключения к базе HOSTNAME, USERNAME, PASSWORD, DBNAME   
		3) далее проверять ниже по заданию по каждому пункту сразу прописаны ответы со страницами вызова и проверки работы приложения 
		 
		 
		 
		 
		 
		СТРУКТУРА ПРИЛОЖЕНИЯ: 
		все просто по минимуму,	к индексу клеются файлы api для запуска и работы с контентом, conf для вынесения настроек и констант, db для работы с базой, routing для работы с гетом и постом
   
 
 
 
 
		ЗАДАНИЕ/РЕШЕНИЯ:
		Функциональность
		приложения: 1. Обязательно
		— получение списка пользователей по критерию (nick, login, email), GETзапрос
ОТВЕТ:
проработаны гет запросы:
/?get_users&email=3dsite@bk.ru  //получить юзера с email=3dsite@bk.ru
/?get_users&nick=gosha3		    //получить юзера с nick=gosha3
/?get_users&login=igor4         //получить юзера с login=igor4
		— получение пользователя по id, GETзапрос
ОТВЕТ:
проработан гет запрос
/?get_users&id=2				 //получить юзера с id=2
		— обновление пользователя (изменение ника, email), POSTзапрос
ОТВЕТ:
проработаны пост запрос
/update_user&nick=newNick&id=2	 //обновить у юзера с id=2 ник на newNick  	
/update_user&email=newEmail&id=2 //обновить у юзера с id=2 email на newEmail  	
		
		
		— выбор типа возвращаемых данных (json или xml, по выбору клиентского приложения)
ОТВЕТ:
проработан входной гет параметр datetype
xml возвращает если /?get_users&email=user4@mail.ru&datetype=xml
json соответственно /?get_users&email=user4@mail.ru&datetype=json 
так же если вообще не установлен тоже ответ в json	
	
	
		2. Опционально
		— доступ к API только авторизованному клиентскому приложению
ОТВЕТ:
можно создать и подключить целый класс авторизации с расширенной проверкой и куков и админского хеша из базы, либо сделать простую проверку на наличие соответствующих параметров в сессии в индексе		
		
		
		
		— кастомные страницы 404й и 500й ошибок
ОТВЕТ:		
в .htaccess вписаны 
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html
тест 404 /четырехсоточка		 		
		
		
		
		— механизм переключения окружения (development, production)
ОТВЕТ:		
Режим работы API (Development || Production) задает константа DEBUG_MODE в конфиге, при работе по локальным ip ошибки показаны и скрыты на удаленном сервере. Режим работы с проверкой по ip предложен как вариант автоматизации и может быть реализован в простом использованию error_reporting (E_ALL) для отладки и error_reporting (0) для рабочей версии
		
	
		Дополнительное задание:
		Представьте, что суточная нагрузка на приложение составит 5 000 000 хитов.
		Опишите предполагаемое окружение и необходимые сервисы, которые
		могут понадобиться, чтобы выдержать подобную нагрузку
ОТВЕТ:
врать не буду, о высоконагруженных проектах знаю только по наслышке и сам никогда не сталкивался. Могу предположить, что вначале копать стоит в сторону работы с базой данных, а именно с оптимизацией запросов. Проставить где нужно индексы по колонкам которые участвуют в выборке. LIKE поменять на фуултекст. Как-то применял вьюхи mysql View которые можно посоздавать на определенные категории запросов, должны маленько ускорить приложение. Так же часть логики можно переложить в хранимые процедуры. Еще интересен у mysql тип таблиц MEMORY который хранит все данные в оперативной памяти машины, на диске их не записывает. Дает возможным делать селект раз в 10 быстрее innoDB и в 20 myisam. Смотря по назначению приложения где больше выборки или инсерта выбирать типы таблиц innoDB и myisam, где первые быстрее работают на выборку, вторые на инсерт/абдейт.
Я не администратор баз данных и никогда им не буду, но предполагаю, что возможно проанализировать выборки из базы, да это и без базы можно просмотреть, по статистике посещений прикинуть в каких выборках больше частота и задать этим выборкам отдельное нахождение во временных таблицах что-то типа кеширования, и этим таблицам задать как раз тип MEMORY. Таким образом можно снизить нагрузку на сложные выборки, путем их кеширования во временные скоростные таблицы. 
Нагрузку дает и сам html, по каждой картинке, файлу идет запрос на сервер. Здесь однозначно необходимо задействовать спрайты, группировку css и js в один файл.
   
заголовки 304 Not Modified
я думаю можно задействовать и кеш вообще всех страниц html, там где идет с выборкой из базы. По каждому запросу в отдельную папку заливать весь html+сжатый без пробелов и уже следующему не нужно вообще в базу лезть а просто отдавать готовый файл. Здесь конечно нужно смотреть по обновлению контента, если динамика большая то делать проверки нужно ли кешировать заново или нет.
Слышал еще про memcache, но только слышал	
	
понимаю что язык программирования самого веб приложения так же влияет на скорость работы. И на таких нагрузках наверное стоит посмотреть в сторону более низкоуровневого языка, может переложить часть логики на язык си. Знакомый спец по си говорил, что скорость приложения возможно таким образом увеличить раз 300-500, только одним переходом с php на си.
И конечно же самое для меня дремучее, это сервера. Предполагаю, что можно разделить нагрузку. В принципе здесь не нужно семи пядей во лбу чтобы понимать, что все дело в запросах а каждый запрос на сервер это еще куча подзапросов(как я уже говорил по картинкам, файлам и т.д.) Так вот к примеру те же картинки можно держать на другом сервере. Однозначно уже есть 100% рабочие схемы и грамотным языком расписанные.
Так же сами машины где сайт крутиться, если это обычный хостинг то уже понятно что будет)) а если сервер то для доп. надежности можно увеличить параметры производительности серверов. Плюс задействовать вместо обычных дисков скоростные ssd.
		
